
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.5">
    
    
      
        <title>Car - Hubit Docs</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-price-of-a-car" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    

      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Hubit Docs" class="md-header__button md-logo" aria-label="Hubit Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hubit Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Car
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
<p style="color:RGBA(0,0,0,.3); font-size: 10px; padding-left: 10px">
    Page built on Mar 17 2022 for version 0.5.0.
</p>

    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Hubit Docs" class="md-nav__button md-logo" aria-label="Hubit Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Hubit Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        First steps
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="examples.html" class="md-nav__link">
        Summary
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Car
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="example-car.html" class="md-nav__link md-nav__link--active">
        Car
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    Components
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#component-entrypoint-function" class="md-nav__link">
    Component entrypoint function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-bindings" class="md-nav__link">
    Component bindings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tips-on-refactoring" class="md-nav__link">
    Tips on refactoring
  </a>
  
    <nav class="md-nav" aria-label="Tips on refactoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#car-model-0" class="md-nav__link">
    Car model 0
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#car-model-1" class="md-nav__link">
    Car model 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#car-model-2" class="md-nav__link">
    Car model 2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#car-model-3" class="md-nav__link">
    Car model 3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#path-to-the-entrypoint-function" class="md-nav__link">
    Path to the entrypoint function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running" class="md-nav__link">
    Running
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rendering" class="md-nav__link">
    Rendering
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    Validation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caching" class="md-nav__link">
    Caching
  </a>
  
    <nav class="md-nav" aria-label="Caching">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-level-caching" class="md-nav__link">
    Model-level caching
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-level-caching" class="md-nav__link">
    Component-level caching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example-wall.html" class="md-nav__link">
        Wall
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example-tanks.html" class="md-nav__link">
        Tanks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Code Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Code Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Code Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="hubit-reference.html" class="md-nav__link">
        Hubit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="config-reference.html" class="md-nav__link">
        Config & data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="log-reference.html" class="md-nav__link">
        Log
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="changelog.html" class="md-nav__link">
        Change log
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    Components
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#component-entrypoint-function" class="md-nav__link">
    Component entrypoint function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-bindings" class="md-nav__link">
    Component bindings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tips-on-refactoring" class="md-nav__link">
    Tips on refactoring
  </a>
  
    <nav class="md-nav" aria-label="Tips on refactoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#car-model-0" class="md-nav__link">
    Car model 0
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#car-model-1" class="md-nav__link">
    Car model 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#car-model-2" class="md-nav__link">
    Car model 2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#car-model-3" class="md-nav__link">
    Car model 3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#path-to-the-entrypoint-function" class="md-nav__link">
    Path to the entrypoint function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running" class="md-nav__link">
    Running
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rendering" class="md-nav__link">
    Rendering
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    Validation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caching" class="md-nav__link">
    Caching
  </a>
  
    <nav class="md-nav" aria-label="Caching">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-level-caching" class="md-nav__link">
    Model-level caching
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-level-caching" class="md-nav__link">
    Component-level caching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="the-price-of-a-car">The price of a car</h1>
<p>In this example we consider a simplified price calculation for a car. The example some basic <code>hubit</code> features and shows three different ways of implementing the car prices calculation. To a large extent, the example follows <a href="https://github.com/mrsonne/hubit/tree/master/examples/car"><code>examples/car</code></a>. The example will be explained and some key <code>Hubit</code> terminology will be introduced.</p>
<p>In the example let us imagine that we are calculating the price of a car based on the names of the individual parts. So the calculation involves a lookup of the price for each part and a summation of the parts prices.</p>
<h2 id="components">Components</h2>
<p>First, your existing tools each need to be wrapped as a <code>Hubit</code> <a class="autorefs autorefs-internal" href="config-reference.html#hubit.config.HubitModelComponent">component</a>. A <code>Hubit</code> component is a computational task that has bindings to the input data and to the results data. The <a class="autorefs autorefs-internal" href="config-reference.html#hubit.config.HubitBinding">bindings</a> define which attributes the component</p>
<ul>
<li><em>consumes</em> from the shared input data structure,</li>
<li><em>consumes</em> from the shared results data structure, and</li>
<li><em>provides</em> to the shared results data structure.</li>
</ul>
<p>From the bindings <code>Hubit</code> can check that all required input data and results data is available before the computational task is executed. The bindings are defined in a <em>model configuration file</em> and are passed to the component <em>entrypoint function</em>.</p>
<h3 id="component-entrypoint-function">Component entrypoint function</h3>
<p>Below you can see some pseudo code for the calculation for the car price calculation. The example is available in <a href="https://github.com/mrsonne/hubit/tree/master/examples/car/components/mod1_cmp1.py"><code>mod1_cmp1.py</code></a></p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">price</span><span class="p">(</span><span class="n">_input_consumed</span><span class="p">,</span> <span class="n">results_provided</span><span class="p">):</span>
    <span class="c1"># Extract required input data here</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">_input_consumed</span><span class="p">[</span><span class="s1">&#39;part_counts&#39;</span><span class="p">]</span> 
    <span class="n">names</span> <span class="o">=</span> <span class="n">_input_consumed</span><span class="p">[</span><span class="s1">&#39;part_names&#39;</span><span class="p">]</span> 

    <span class="c1"># Look up the price of the part based on the part name (local data, database)</span>
    <span class="n">unit_prices</span> <span class="o">=</span> <span class="p">[</span><span class="n">my_lookup</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>

    <span class="c1"># Compute results here (web service, C, Python ...)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="p">[</span> <span class="n">count</span><span class="o">*</span><span class="n">unit_price</span> 
                    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">unit_price</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">unit_prices</span><span class="p">)</span> <span class="p">]</span> <span class="p">)</span>

    <span class="n">results_provided</span><span class="p">[</span><span class="s1">&#39;car_price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</code></pre></div>
<p>The entrypoint function in a component (<code>price</code> in the example above) should expect the arguments <code>_input_consumed</code> and <code>results_provided</code> in that order. Results data calculated in the components should only be added to the latter. The values stored in the keys <code>part_counts</code> and <code>part_names</code> in <code>_input_consumed</code> are controlled by the bindings in the model configuration file.</p>
<h3 id="component-bindings">Component bindings</h3>
<p>Before we look at the <em>bindings</em> let us look at the input data. The input can, like in the example below, be defined in a yml file. In the car example the input data is a list containing two cars each with a number of parts</p>
<div class="highlight"><pre><span></span><code><span class="nt">cars</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">parts</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wheel1</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chassis1</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bumper</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">engine1</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">radio</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">parts</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wheel2</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chassis2</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bumper</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">engine14</span><span class="w"></span>
</code></pre></div>
<p>The <code>price</code> entrypoint function above expects a list of part names stored in the field <code>part_names</code> and a list of the corresponding part counts stored in the field <code>part_counts</code>. To make such lists available for the entrypoint function, the model configuration file should contain the lines below.</p>
<div class="highlight"><pre><span></span><code><span class="nt">consumes_input</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">part_names</span><span class="w"> </span><span class="c1"># key in _input_consumed exposed to the entrypoint function</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].parts[:@IDX_PART].name</span><span class="w"> </span><span class="c1"># path in input data</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">part_counts</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].parts[:@IDX_PART].count</span><span class="w"></span>
</code></pre></div>
<p>The strings in square braces are called <a class="autorefs autorefs-internal" href="config-reference.html#hubit.config.ModelIndexSpecifier">index specifiers</a>. The index specifier <code>:@IDX_PART</code> refers to all items for the <em>index identifier</em> <code>IDX_PART</code>. The index specifier <code>IDX_CAR</code> is simply refers to a specific car. The index identifiers (here <code>IDX_PART</code> and <code>IDX_CAR</code>) are identification strings that the user can choose <a class="autorefs autorefs-internal" href="config-reference.html#hubit.config.ModelIndexSpecifier">with some limitations</a>.</p>
<p>With the input data and bindings shown above, the content of <code>_input_consumed</code> in the <code>price</code> function for the car at index 1 will be</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
  <span class="s1">&#39;part_counts&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
  <span class="s1">&#39;part_names&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="s1">&#39;wheel2&#39;</span><span class="p">,</span> <span class="s1">&#39;chassis2&#39;</span><span class="p">,</span> <span class="s1">&#39;bumper&#39;</span><span class="p">,</span> <span class="s1">&#39;engine14&#39;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>i.e. the component's entrypoint function will have all counts and part names for a single car in this case the car at index 1 available in the input.</p>
<p>In the last line of the <code>price</code> function, the car price is added to the results</p>
<div class="highlight"><pre><span></span><code><span class="n">results_provided</span><span class="p">[</span><span class="s1">&#39;car_price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</code></pre></div>
<p>To enable the transfer of the calculated car price to the correct path in the shared results data object we must add a binding for the name <code>car_price</code>. If, for example, we want to store the car price in a field called <code>price</code> at the same car index as where the input data was taken from, the binding below should be added to the model file.</p>
<div class="highlight"><pre><span></span><code><span class="nt">provides_results</span><span class="p">:</span><span class="w"> </span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">car_price</span><span class="w"> </span><span class="c1"># internal name (key) in results_provided</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].price</span><span class="w"> </span><span class="c1"># path in the shared results data</span><span class="w"></span>
</code></pre></div>
<p>The index specifier <code>IDX_CAR</code> in the binding path tells <code>Hubit</code> to store the car price at the same car index as where the input was taken from. Note that the component itself is unaware of which car (car index) the input represents.</p>
<p>Collecting the bindings we get</p>
<div class="highlight"><pre><span></span><code><span class="nt">provides_results</span><span class="p">:</span><span class="w"> </span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">car_price</span><span class="w"> </span><span class="c1"># internal name in the component</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].price</span><span class="w"> </span><span class="c1"># path in the shared data </span><span class="w"></span>
<span class="nt">consumes_input</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">part_name</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].parts[:@IDX_PART].name</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">part_counts</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].parts[:@IDX_PART].count</span><span class="w"></span>
</code></pre></div>
<p>Read more about <a class="autorefs autorefs-internal" href="config-reference.html#hubit.config.HubitModelPath">paths</a>, <a class="autorefs autorefs-internal" href="config-reference.html#hubit.config.ModelIndexSpecifier">index specifiers</a> and index identifiers in the documentation.</p>
<h3 id="tips-on-refactoring">Tips on refactoring</h3>
<p>The flexibility of the <code>Hubit</code> binding paths allows you to match the interfaces of your existing tools. Further, this flexibility enables you to refactor to get good modularity and optimize for speed when multi-processing is used. Below we will show three versions of the car model and outline some key differences when multi-processing is used.</p>
<h4 id="car-model-0">Car model 0</h4>
<p>In <a href="https://github.com/mrsonne/hubit/blob/master/examples/car/model0.yml"><code>model0.yml</code></a> the price calculation receives an entire car object at a specific car index (<code>IDX_CAR</code>). This allows the component to store results data on the corresponding car index in the results data object that <code>Hubit</code> creates.</p>
<div class="highlight"><pre><span></span><code><span class="nt">provides_results</span><span class="p">:</span><span class="w"> </span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">car_price</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].price</span><span class="w"></span>
<span class="nt">consumes_input</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">car</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR]</span><span class="w"></span>
</code></pre></div>
<p>This model allows queries such as <code>cars[:].price</code> and <code>cars[1].price</code>. If car objects in the input data only contains <code>count</code> and <code>name</code> (like in the example above) this simple model definition is more or less equivalent to the more elaborate model shown above. If, on the other hand, car objects in the input data contains more data this (irrelevant) data would be exposed to the price calculation function. Further, in the implementation of the car price calculation an undesirable tight coupling to the input data structure would be unavoidable. The entrypoint function could look something like this</p>
<div class="highlight"><pre><span></span><code>  <span class="n">counts</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
      <span class="nb">zip</span><span class="p">(</span>
          <span class="o">*</span><span class="p">[(</span><span class="n">part</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">],</span> <span class="n">part</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">_input_consumed</span><span class="p">[</span><span class="s2">&quot;car&quot;</span><span class="p">][</span><span class="s2">&quot;parts&quot;</span><span class="p">]]</span>
      <span class="p">)</span>
  <span class="p">)</span>
  <span class="n">unit_prices</span> <span class="o">=</span> <span class="p">[</span><span class="n">my_lookup_function</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
  <span class="n">result</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">count</span> <span class="o">*</span> <span class="n">unit_price</span> <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">unit_price</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">unit_prices</span><span class="p">)])</span>
  <span class="n">results_provided</span><span class="p">[</span><span class="s2">&quot;car_price&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</code></pre></div>
<p>Notice how the <code>parts</code> list and the <code>count</code> and <code>name</code> attributes are accessed directly on the car object leading to a tight coupling.</p>
<h4 id="car-model-1">Car model 1</h4>
<p><a href="https://github.com/mrsonne/hubit/blob/master/examples/car/model1.yml"><code>model1.yml</code></a> is the one described above model 0 where the car price is calculated in a single component i.e. in a single worker process. Such an approach works well if the lookup of parts prices is fast and the car price calculation is also fast. If, however, the lookup is fast while the car price calculation is slow, and we imagine that another component is also consuming the parts prices, then the car price calculation would be a bottleneck. In such cases, separating the lookup from the price calculation would probably boost performance. Models 2 and 3 present two different ways of implementing such a separation.</p>
<h4 id="car-model-2">Car model 2</h4>
<p>In <a href="https://github.com/mrsonne/hubit/blob/master/examples/car/model2.yml"><code>model2.yml</code></a> the parts price lookup and the car price calculation are implemented in two separate components. Further, the component that is responsible for the price lookup retrieves the price for one part only. In other words, each lookup will happen in a separate (optionally asynchronous) worker process. When all the lookup processes are done, the price component sums the parts prices to get the total car price. The relevant sections of the model file could look like this</p>
<div class="highlight"><pre><span></span><code><span class="c1"># price for one part</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">consumes_input</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">part_name</span><span class="w"></span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].parts[IDX_PART].name</span><span class="w"> </span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">part_count</span><span class="w"></span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].parts[IDX_PART].count</span><span class="w"></span>
<span class="w">  </span><span class="nt">provides_results</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">part_price</span><span class="w"></span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].parts[IDX_PART].price</span><span class="w"></span>

<span class="c1"># car price from parts prices</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">consumes_results</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prices</span><span class="w"></span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].parts[:@IDX_PART].price</span><span class="w"></span>
<span class="w">  </span><span class="nt">provides_results</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">car_price</span><span class="w"> </span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].price</span><span class="w"></span>
</code></pre></div>
<p>Notice that the first component consumes a specific part index (<code>IDX_PART</code>) for a specific car index (<code>IDX_CAR</code>). This allows the component to store results data on a specific part index for a specific car index. The entrypoint function for the first component (price for one part) could look something like this</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">part_price</span><span class="p">(</span><span class="n">_input_consumed</span><span class="p">,</span> <span class="n">results_provided</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">_input_consumed</span><span class="p">[</span><span class="s1">&#39;part_count&#39;</span><span class="p">]</span> 
    <span class="n">name</span> <span class="o">=</span> <span class="n">_input_consumed</span><span class="p">[</span><span class="s1">&#39;part_name&#39;</span><span class="p">]</span> 
    <span class="n">results_provided</span><span class="p">[</span><span class="s1">&#39;part_price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span><span class="o">*</span><span class="n">my_lookup_function</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>
<p>The entrypoint function for the second component (car price) could look like this</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">car_price</span><span class="p">(</span><span class="n">_input_consumed</span><span class="p">,</span> <span class="n">results_provided</span><span class="p">):</span>
    <span class="n">results_provided</span><span class="p">[</span><span class="s1">&#39;car_price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">_input_consumed</span><span class="p">[</span><span class="s1">&#39;prices&#39;</span><span class="p">]</span> <span class="p">)</span>
</code></pre></div>
<p>In this refactored model <code>Hubit</code> will, when submitting a query for the car price using the multi-processor flag, execute each part price calculation in a separate asynchronous worker process. If the part price lookup is fast, the overhead introduced by multi-processing may be render model 2 less attractive. In such cases performing all the lookups in a single component, but still keeping the lookup separate from the car price calculation, as shown in car model 3, could be a good solution.</p>
<h4 id="car-model-3">Car model 3</h4>
<p>In <a href="https://github.com/mrsonne/hubit/blob/master/examples/car/model3.yml"><code>model3.yml</code></a> all price lookups take place in one single component and the car price calculation takes place in another component. For the lookup component, the relevant sections of the model file could look like this</p>
<div class="highlight"><pre><span></span><code><span class="c1"># price for all parts</span><span class="w"></span>
<span class="nt">consumes_input</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parts_name</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].parts[:@IDX_PART].name</span><span class="w"> </span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parts_count</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].parts[:@IDX_PART].count</span><span class="w"></span>
<span class="nt">provides_results</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parts_price</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].parts[:@IDX_PART].price</span><span class="w"></span>
</code></pre></div>
<p>Notice that the component consumes all part indices (<code>:@IDX_PART</code>) for a specific car index (<code>IDX_CAR</code>). This allows the component to store results data on all part indices for a specific car index. The entrypoint for the first component (price for all parts) could look something like this</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">part_price</span><span class="p">(</span><span class="n">_input_consumed</span><span class="p">,</span> <span class="n">results_provided</span><span class="p">):</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">_input_consumed</span><span class="p">[</span><span class="s1">&#39;parts_count&#39;</span><span class="p">]</span> 
    <span class="n">names</span> <span class="o">=</span> <span class="n">_input_consumed</span><span class="p">[</span><span class="s1">&#39;parts_name&#39;</span><span class="p">]</span> 
    <span class="n">results_provided</span><span class="p">[</span><span class="s1">&#39;parts_price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">count</span><span class="o">*</span><span class="n">my_lookup_function</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
    <span class="p">]</span>
</code></pre></div>
<p>In this model, the car price component is identical to the one used in model 2 and is therefore omitted here.</p>
<h3 id="path-to-the-entrypoint-function">Path to the entrypoint function</h3>
<p>To tie together the bindings with the the Python code that does the actual work you need to add the path of the Python source code file to the model file. For the first car model it could look like this.</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./components/price1.py</span><span class="w"> </span>
<span class="w">  </span><span class="nt">func_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">price</span><span class="w"></span>
<span class="w">  </span><span class="nt">provides_results</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">car_price</span><span class="w"></span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].price</span><span class="w"></span>
<span class="w">  </span><span class="nt">consumes_input</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">part_names</span><span class="w"></span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].parts[:@IDX_PART].name</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">part_counts</span><span class="w"></span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cars[IDX_CAR].parts[:@IDX_PART].count</span><span class="w"></span>
</code></pre></div>
<p>The specified path should be relative to <a class="autorefs autorefs-internal" href="hubit-reference.html#hubit.model.HubitModel"><code>model's</code></a> <code>base_path</code> attribute, which defaults to the location of the model file when the model is initialized using the <a class="autorefs autorefs-internal" href="hubit-reference.html#hubit.model.HubitModel.from_file"><code>from_file</code></a> method. You can also use a <a class="autorefs autorefs-internal" href="config-reference.html#hubit.config.HubitModelComponent">dotted path</a> e.g.</p>
<div class="highlight"><pre><span></span><code><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hubit_components.price1</span><span class="w"></span>
<span class="nt">is_dotted_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w"></span>
</code></pre></div>
<p>where <code>hubit_components</code> would typically be a package you have installed in site-packages.</p>
<h2 id="running">Running</h2>
<p>To get results from a model requires you to submit a <a class="autorefs autorefs-internal" href="config-reference.html#hubit.config.Query"><code>query</code></a>. After <code>Hubit</code> has processed the query the values of the queried attributes are returned in the <em>response</em>. A query may spawn many component workers that may each represent an instance of the same or different model components. Below are two examples of queries and the corresponding responses.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Load model from file</span>
<span class="n">hmodel</span> <span class="o">=</span> <span class="n">HubitModel</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;model1.yml&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;car&#39;</span><span class="p">)</span>

<span class="c1"># Load the input</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">THISPATH</span><span class="p">,</span> <span class="s2">&quot;input.yml&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

<span class="c1"># Set the input on the model object</span>
<span class="n">hmodel</span><span class="o">.</span><span class="n">set_input</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>

<span class="c1"># Query the model</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cars[0].price&#39;</span><span class="p">]</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">hmodel</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</code></pre></div>
<p>The response looks like this</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;cars[0].price&#39;</span><span class="p">:</span> <span class="mf">4280.0</span><span class="p">}</span>
</code></pre></div>
<p>Is this case the parts prices will also be calculated by <code>Hubit</code> to create the response. A query for parts prices for all cars looks like this</p>
<div class="highlight"><pre><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cars[:].parts[:].price&#39;</span><span class="p">]</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">hmodel</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</code></pre></div>
<p>and the corresponding response is</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
  <span class="s1">&#39;cars[:].parts[:].price&#39;</span><span class="p">:</span> 
  <span class="p">[</span>
    <span class="p">[</span><span class="mf">480.0</span><span class="p">,</span> <span class="mf">1234.0</span><span class="p">,</span> <span class="mf">178.0</span><span class="p">,</span> <span class="mf">2343.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">312.0</span><span class="p">,</span> <span class="mf">1120.0</span><span class="p">,</span> <span class="mf">178.0</span><span class="p">,</span> <span class="mf">3400.0</span><span class="p">]</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="rendering">Rendering</h2>
<p>If Graphviz is installed <code>Hubit</code> can render models and queries. In the example below we have rendered the query <code>[cars[0].price]</code> i.e. the price of the car at index 0.</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/mrsonne/hubit/blob/master/examples/car/images/query_car_2.png">
  <img src="https://github.com/mrsonne/hubit/raw/master/examples/car/images/query_car_2.png" width="1000" style="max-width:100%;">
</a></p>
<p>The graph illustrates nodes in the input data structure, nodes in the the results data structure, the calculation components involved in creating the response as well as hints at which attributes flow in and out of these components. The triple bar icon  indicates that the node is accessed by index and should therefore be a list. The graph was created using the command below.</p>
<div class="highlight"><pre><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cars[0].price&#39;</span><span class="p">]</span>
<span class="n">hmodel</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</code></pre></div>
<h2 id="validation">Validation</h2>
<p>Running</p>
<div class="highlight"><pre><span></span><code><span class="n">hmodel</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</code></pre></div>
<p>will validate various aspects of the model.</p>
<p>Running</p>
<div class="highlight"><pre><span></span><code><span class="n">hmodel</span><span class="o">.</span><span class="n">validate</span><span class="p">([</span><span class="s1">&#39;cars[0].price&#39;</span><span class="p">])</span>
</code></pre></div>
<p>will validate various aspects of the query.</p>
<h2 id="caching">Caching</h2>
<h3 id="model-level-caching">Model-level caching</h3>
<p>By default <code>Hubit</code> never caches results internally. A <code>Hubit</code> model can, however, write results to disk automatically by using the <a class="autorefs autorefs-internal" href="hubit-reference.html#hubit.model.HubitModel.set_model_caching"><code>set_model_caching</code></a> method to set the caching level. Results caching is useful when you want to avoid spending time calculating the same results multiple times or to have <code>Hubit</code> create restart snapshots. The table below comes from printing the log after running model 2 with and without model-level caching</p>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">hmodel</span><span class="o">.</span><span class="n">log</span><span class="p">())</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>--------------------------------------------------------------------------------------------------
Query finish time    Query took (s)        Worker name        Workers spawned Component cache hits
--------------------------------------------------------------------------------------------------
21-Mar-2021 20:46:31     0.1              car_price                0                 0
                                         part_price                0                 0
21-Mar-2021 20:46:31     1.8              car_price                3                 0
                                         part_price               14                 0
--------------------------------------------------------------------------------------------------
</code></pre></div>
<p>The second run (top) using the cache is much faster than the first run (bottom) that spawns 17 workers to complete the query.</p>
<p>The model cache can be cleared using the <a class="autorefs autorefs-internal" href="hubit-reference.html#hubit.model.HubitModel.clear_cache"><code>clear_cache</code></a>  method on a <code>Hubit</code> model. To check if a model has an associated cached result use <a class="autorefs autorefs-internal" href="hubit-reference.html#hubit.model.HubitModel.has_cached_results"><code>has_cached_results</code></a> method on a <code>Hubit</code> model. Cached results for all models can be cleared by using <a class="autorefs autorefs-internal" href="hubit-reference.html#hubit.__init__.clear_hubit_cache"><code>hubit.clear_hubit_cache()</code></a>.</p>
<h3 id="component-level-caching">Component-level caching</h3>
<p>Component-level caching can be activated using <a class="autorefs autorefs-internal" href="hubit-reference.html#hubit.model.HubitModel.set_component_caching">set_component_caching</a>. By default component-level caching is off. If component-level caching is on, the consumed data for all spawned component workers and the corresponding results will be stored in memory during execution of a query. If <code>Hubit</code> finds that, in the same query, two workers refer to the same model component and the input data are identical, the second worker will simply use the results produced by the first worker. The cache is not shared between sequential queries to a model. Also, the component-level cache is not shared between the individual sampling runs using <a class="autorefs autorefs-internal" href="hubit-reference.html#hubit.model.HubitModel.get_many"><code>get_many</code></a> method.</p>
<p>The table below comes from printing the log after running car model 2 with and without component-level caching</p>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">hmodel</span><span class="o">.</span><span class="n">log</span><span class="p">())</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>--------------------------------------------------------------------------------------------------
Query finish time    Query took (s)        Worker name        Workers spawned Component cache hits
--------------------------------------------------------------------------------------------------
21-Mar-2021 20:48:26     1.1              car_price                3                 1
                                         part_price               14                 6
21-Mar-2021 20:48:25     1.8              car_price                3                 0
                                         part_price               14                 0
--------------------------------------------------------------------------------------------------
</code></pre></div>
<p>The second run (top) uses component-caching and is faster than the first run (bottom).
Both queries spawn 17 workers in order to complete the query, but in the case where
component-caching is active (top) 7 workers reuse results provided by the remaining 10 workers.</p>
<p>For smaller jobs any speed-up obtained my using component-level caching cannot be seen on
the wall clock when using multi-processing. The effect will, however, be apparent in
the model <a class="autorefs autorefs-internal" href="hubit-reference.html#hubit.model.HubitModel.log">log</a> as seen above.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.bd0b6b67.min.js", "version": "0.5.0"}</script>
    
    
      <script src="assets/javascripts/bundle.467223ff.min.js"></script>
      
    
  </body>
</html>