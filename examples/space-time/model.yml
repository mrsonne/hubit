components:

# Calculates the liquid volume and composition for the first cell
  - &mix
    path: ./components/mix.py
    # index_scope:
      # IDX_CELL: ":"
      # IDX_BATCH: "0"
    provides_results: 
      - name: mole_numbers_tot
        path: batches[IDX_BATCH].cells[IDX_CELL].mole_numbers_tot
      - name: V_liq
        path: batches[IDX_BATCH].cells[IDX_CELL].V_liq
    consumes_input:
      # TODO: Temporary since we need to infer the tree structure for the provided index context 
      - name: feed_concs
        path: batches[IDX_BATCH].cells[IDX_CELL].ini.concs
      - name: V_feed
        path: batches[IDX_BATCH].cells[IDX_CELL].ini.V
      # - name: feed_concs
      #   # path: feed[IDX_CELL].concs
      #   path: cells[IDX_CELL].ini.concs
      # - name: V_feed
      #   path: feed[IDX_CELL].V

# Overwrites the source for liquid composition and liquid volume
  # - <<: *mix
  #   index_scope:
  #     IDX_CELL: "1:"
  #     IDX_BATCH: "1:"
  #   consumes_results:
  #     - name: feed_concs
  #       path: batches[IDX_BATCH-1].cells[IDX_CELL-1].liq_concs
  #     - name: V_feed
  #       path: batches[IDX_BATCH-1].cells[IDX_CELL-1].V_liq
  #     # - name: solid_composition
  #     #   path: batches[IDX_BATCH-1].cells[IDX_CELL].sol_composition

#  Find concentrations in liquid and solid phases based on total conc 
#  Same for all cells & batches
  - path: ./components/eq_non_competitive.py
    provides_results: 
      - name: liq_concs
        path: batches[IDX_BATCH].cells[IDX_CELL].liq_concs
      - name: sol_concs
        path: batches[IDX_BATCH].cells[IDX_CELL].sol_concs
    consumes_results:
      - name: V_liq
        path: batches[IDX_BATCH].cells[IDX_CELL].V_liq
      - name: mole_numbers_feed
        path: batches[IDX_BATCH].cells[IDX_CELL].mole_numbers_tot
    consumes_input:
      # HubitModelConfig._query_depths
      # ['batches[*].cells[*].ini.concs', 'batches[*].cells[*].ini.V', 'batches[*].cells[*]']
      # Bug: stops at 'batches[*].cells[*]' since we don't check if paths in list are actually 
      # the same but at different depths. 
      - name: cell
        # TODO: cells do not change in time but for now we need a tree with index context IDX_BATCH-IDX_CELL
        path: batches[IDX_BATCH].cells[IDX_CELL]
